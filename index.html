<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CV Builder Pro ‚Äî AI-Powered Resume Builder</title>

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Fallback bundle -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Dependencias expl√≠citas (robusto) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root{
      --ink:#111827;
      --muted:#4B5563;
      --line:#E5E7EB;
      --accent:#0B1F3A;
      --bg:#F3F4F6;
      --paper:#fff;

      --name-size: 34px;
      --headline-size: 15.5px;
      --p-size: 12.6px;
      --bullet-size: 12.3px;
      --title-size: 11.8px;
      --jobrole-size: 13.4px;

      --pad-mm: 12mm;
      --gap-mm: 10mm;
      --radius: 12px;

      --cv-cols: 1fr 62mm;
      --header-cols: 1fr 36mm;
    }

    /* ===== Templates ===== */
    body.tpl-classic{
      --accent:#0B1F3A;
      --cv-cols: 1fr 62mm;
      --header-cols: 1fr 36mm;
      --radius: 12px;
      --line:#E5E7EB;
    }
    body.tpl-modern{
      --accent:#111827;
      --line:#E6EAF0;
      --cv-cols: 1fr;
      --header-cols: 1fr 36mm;
      --radius: 16px;
    }
    body.tpl-sidebar{
      --accent:#111827;
      --line:#E6EAF0;
      --cv-cols: 70mm 1fr;
      --header-cols: 1fr 36mm;
      --radius: 14px;
    }
    body.tpl-minimal{
      --accent:#111827;
      --line:#F3F4F6;
      --cv-cols: 1fr 58mm;
      --header-cols: 1fr;
      --radius: 10px;
    }
    body.tpl-executive{
      --accent:#1E40AF;
      --line:#DBEAFE;
      --cv-cols: 1fr 65mm;
      --header-cols: 1fr 36mm;
      --radius: 8px;
      --bg:#F8FAFC;
    }
    body.tpl-creative{
      --accent:#7C3AED;
      --line:#EDE9FE;
      --cv-cols: 1fr;
      --header-cols: 1fr 36mm;
      --radius: 20px;
      --bg:#FAFAF9;
    }

    /* ===== Color Themes ===== */
    body.theme-blue{ --accent:#1E40AF; --line:#DBEAFE; }
    body.theme-purple{ --accent:#7C3AED; --line:#EDE9FE; }
    body.theme-green{ --accent:#059669; --line:#D1FAE5; }
    body.theme-red{ --accent:#DC2626; --line:#FEE2E2; }
    body.theme-orange{ --accent:#EA580C; --line:#FFEDD5; }

    /* ===== Photo toggle ===== */
    body.no-photo{
      --header-cols: 1fr;
    }
    body.no-photo #cvPhotoBox{ display:none !important; }

    /* ===== Compact ===== */
    body.compact{
      --name-size: 31px;
      --headline-size: 14.5px;
      --p-size: 12.0px;
      --bullet-size: 11.8px;
      --title-size: 11.2px;
      --jobrole-size: 13.0px;
      --pad-mm: 11mm;
      --gap-mm: 9mm;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      transition: background 0.3s ease;
    }
    .wrap{
      display:grid;
      grid-template-columns: 460px 1fr;
      gap: 18px;
      padding: 18px;
      max-width: 1600px;
      margin: 0 auto;
    }

    /* ===== Panel ===== */
    .panel{
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      position: sticky;
      top: 14px;
      height: fit-content;
      max-height: calc(100vh - 28px);
      overflow-y: auto;
    }
    .panel h2{
      margin:0 0 10px 0;
      font-size:14px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .panel h2 .badge{
      font-size:10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color:#fff;
      padding:3px 8px;
      border-radius:6px;
      font-weight:900;
      letter-spacing:.08em;
    }
    .row{ display:grid; grid-template-columns: 1fr; gap:6px; margin-bottom:10px; }
    label{ 
      font-size:12px; 
      color:var(--muted); 
      font-weight:600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    input, textarea, select{
      width:100%;
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 10px;
      font: inherit;
      font-size:13px;
      outline:none;
      background:#fff;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    input:focus, textarea:focus, select:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(11, 31, 58, 0.1);
    }
    textarea{ min-height: 88px; resize: vertical; }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .grid3{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    button{
      border:0;
      border-radius:12px;
      padding:10px 12px;
      font-weight:800;
      cursor:pointer;
      background: var(--accent);
      color:#fff;
      font-size:13px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    button:hover:not(:disabled){
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    button:active:not(:disabled){
      transform: translateY(0);
    }
    button:disabled{
      opacity: 0.5;
      cursor: not-allowed;
    }
    button.secondary{
      background:#EEF2F7;
      color:#111827;
      border:1px solid var(--line);
    }
    button.danger{ background:#EF4444; }
    button.ai-btn{
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      position: relative;
    }
    button.ai-btn::before{
      content: '‚ú®';
      margin-right: 6px;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
      margin-top:10px;
    }
    .miniActions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid var(--line);
    }
    .miniActions button{
      padding:8px 10px;
      border-radius:10px;
      font-size:12px;
      font-weight:800;
    }

    /* ===== Loading State ===== */
    .loading-overlay{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(4px);
    }
    .loading-overlay.active{ display: flex; }
    .loading-content{
      background: #fff;
      padding: 32px 48px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .spinner{
      width: 48px;
      height: 48px;
      border: 4px solid var(--line);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin{
      to{ transform: rotate(360deg); }
    }
    .loading-text{
      font-weight: 700;
      font-size: 15px;
      color: var(--ink);
    }

    /* ===== Jobs editor ===== */
    .jobsEditor{
      border-top:1px solid var(--line);
      margin-top:12px;
      padding-top:12px;
    }
    .jobsHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .jobsHeader h3{
      margin:0;
      font-size:13px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--accent);
    }
    .jobCard{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      margin-bottom:10px;
      background:#fff;
      transition: all 0.2s ease;
      cursor: move;
    }
    .jobCard:hover{
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-color: var(--accent);
    }
    .jobCard.dragging{
      opacity: 0.5;
      transform: scale(0.95);
    }
    .jobCardTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .jobCardTop .mini{ display:flex; gap:6px; flex-wrap:wrap; }
    .jobCardTop button{
      padding:7px 9px;
      border-radius:10px;
      font-size:12px;
      font-weight:800;
    }
    .jobCard textarea{ min-height:64px; }

    /* ===== AI Features Panel ===== */
    .ai-panel{
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      color: #fff;
    }
    .ai-panel h3{
      margin: 0 0 12px 0;
      font-size: 13px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .ai-panel button{
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      width: 100%;
      margin-bottom: 8px;
    }
    .ai-panel button:hover{
      background: rgba(255,255,255,0.3);
    }

    /* ===== Preview ===== */
    .stage{
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding-bottom:24px;
    }
    .paperStack{
      display:flex;
      flex-direction:column;
      gap: 16px;
      padding-bottom:24px;
    }
    .paper{
      width: 210mm;
      height: 297mm;
      background: var(--paper);
      box-shadow: 0 18px 40px rgba(0,0,0,.14);
      border-radius: 6px;
      overflow: hidden;
      position: relative;
      break-after: page;
      page-break-after: always;
      transition: box-shadow 0.3s ease;
    }
    .paper:hover{
      box-shadow: 0 24px 48px rgba(0,0,0,.18);
    }
    .paper:last-child{ break-after:auto; page-break-after:auto; }
    .page{
      padding: var(--pad-mm);
      height: 100%;
      position: relative;
    }

    /* ===== CV blocks ===== */
    .header{
      display:grid;
      grid-template-columns: var(--header-cols);
      gap: var(--gap-mm);
      align-items:center;
      padding-bottom: 6mm;
      border-bottom: 1px solid var(--line);
    }
    .name{
      margin:0;
      font-size: var(--name-size);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1.05;
    }
    .headline{
      margin-top: 3mm;
      font-size: var(--headline-size);
      font-weight: 650;
      color: var(--muted);
    }
    .degree{
      margin-top: 2mm;
      font-size: 13.2px;
      font-weight: 850;
      color: var(--accent);
    }
    .contact{
      margin-top: 4mm;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
      word-break: break-word;
    }
    .contact a{
      color: var(--accent);
      text-decoration: none;
      font-weight: 750;
    }
    .contact a:hover{ text-decoration: underline; }

    .photo{
      width: 36mm;
      height: 36mm;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background:#F3F4F6;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#9CA3AF;
      font-weight:800;
      font-size:11px;
    }
    .photo img{ width:100%; height:100%; object-fit:cover; display:block; }

    .layout{
      display:grid;
      grid-template-columns: var(--cv-cols);
      gap: var(--gap-mm);
      padding-top: 7mm;
      height: calc(100% - 52mm);
    }

    .section{ margin-bottom: 7mm; }
    .title{
      font-size: var(--title-size);
      font-weight: 900;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: var(--accent);
      margin: 0 0 3mm 0;
    }
    .p{
      font-size: var(--p-size);
      line-height: 1.6;
      margin: 0;
      white-space: pre-wrap;
    }

    .job{ margin-top: 4.5mm; }
    .jobhead{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 8mm;
      align-items: baseline;
    }
    .jobrole{
      font-size: var(--jobrole-size);
      font-weight: 900;
      margin: 0;
    }
    .jobdate{
      font-size: 11.8px;
      color: var(--muted);
      white-space: nowrap;
      font-weight: 700;
    }
    .jobmeta{
      margin-top: 1.2mm;
      font-size: 11.8px;
      color: var(--muted);
      font-weight: 600;
    }
    ul.bullets{
      margin: 2.5mm 0 0 18px;
      padding: 0;
    }
    ul.bullets li{
      font-size: var(--bullet-size);
      line-height: 1.55;
      margin: 0 0 2mm 0;
    }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:4.5mm;
      margin-bottom:6mm;
      background:#fff;
    }
    .list{ margin:0; padding-left:16px; }
    .list li{ font-size:12.1px; margin-bottom:2mm; }
    .rows{ display:flex; flex-direction:column; gap:2.2mm; }
    .row2{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 6mm;
      align-items: baseline;
    }
    .row2 .l{ font-size:12.2px; line-height:1.45; }
    .row2 .r{
      font-size:12.2px;
      color:var(--muted);
      font-weight:750;
      white-space:nowrap;
    }

    /* Minimal: sin cards */
    body.tpl-minimal .card{ border:0; padding:0; background:transparent; }

    /* Modern */
    body.tpl-modern .layout{ grid-template-columns: 1fr; }
    body.tpl-modern .layout > aside{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap-mm);
      align-content:start;
    }
    body.tpl-modern .layout > aside .card:last-child{ grid-column: 1 / -1; }

    /* Sidebar */
    body.tpl-sidebar .layout{ grid-template-columns: 70mm 1fr; }
    body.tpl-sidebar .layout > aside{ order: -1; }

    /* Creative */
    body.tpl-creative .header{
      background: linear-gradient(135deg, var(--accent) 0%, var(--muted) 100%);
      color: #fff;
      padding: 8mm;
      margin: calc(var(--pad-mm) * -1);
      margin-bottom: 8mm;
      border-bottom: none;
    }
    body.tpl-creative .name,
    body.tpl-creative .headline,
    body.tpl-creative .degree,
    body.tpl-creative .contact,
    body.tpl-creative .contact a{
      color: #fff;
    }

    /* Page 2 extras */
    .page2Grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap-mm);
      margin-top: 6mm;
    }
    .page2Grid .span2{ grid-column: 1 / -1; }

    /* ===== Mobile Responsive ===== */
    @media (max-width: 1200px){
      .wrap{ 
        grid-template-columns: 1fr; 
      }
      .panel{ 
        position:relative; 
        top:auto; 
        max-height: none;
      }
      .stage{ 
        overflow:auto; 
      }
      .paper{
        width: 100%;
        height: auto;
        aspect-ratio: 210 / 297;
      }
    }

    @media (max-width: 768px){
      .wrap{
        padding: 12px;
        gap: 12px;
      }
      .panel{
        padding: 12px;
      }
      .grid2, .grid3{
        grid-template-columns: 1fr;
      }
      .btns{
        flex-direction: column;
      }
      .btns button{
        width: 100%;
      }
      button{
        padding: 12px 16px;
      }
    }

    /* ===== Collapsible Sections (Mobile) ===== */
    .collapsible-section{
      border-bottom: 1px solid var(--line);
      padding: 12px 0;
    }
    .collapsible-header{
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
      padding: 8px 0;
    }
    .collapsible-header h3{
      margin: 0;
      font-size: 13px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
      font-weight: 900;
    }
    .collapsible-icon{
      font-size: 18px;
      transition: transform 0.3s ease;
      color: var(--muted);
    }
    .collapsible-section.collapsed .collapsible-icon{
      transform: rotate(-90deg);
    }
    .collapsible-content{
      max-height: 2000px;
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.3s ease;
      opacity: 1;
    }
    .collapsible-section.collapsed .collapsible-content{
      max-height: 0;
      opacity: 0;
    }

    @media (min-width: 769px){
      .collapsible-section{
        border: none;
        padding: 0;
      }
      .collapsible-header{
        cursor: default;
      }
      .collapsible-icon{
        display: none;
      }
      .collapsible-content{
        max-height: none !important;
        opacity: 1 !important;
      }
    }
  </style>
</head>

<body class="tpl-classic">
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <div class="loading-text" id="loadingText">Processing...</div>
    </div>
  </div>

  <div class="wrap">

    <!-- PANEL -->
    <aside class="panel">
      <h2>CV Builder <span class="badge">PRO</span></h2>

      <!-- AI Panel -->
      <div class="ai-panel">
        <h3>‚ú® AI Features</h3>
        <button id="btnAIOptimize" class="ai-btn" type="button">Optimize All Bullets</button>
        <button id="btnAIProfile" class="ai-btn" type="button">Enhance Profile</button>
        <button id="btnAIGenerate" class="ai-btn" type="button">Generate Job Description</button>
      </div>

      <!-- Template & Style Section -->
      <div class="collapsible-section" id="sectionTemplate">
        <div class="collapsible-header" onclick="toggleSection('sectionTemplate')">
          <h3>Template & Style</h3>
          <span class="collapsible-icon">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div class="grid2">
            <div class="row">
              <label>Template</label>
              <select id="inTemplate">
                <option value="tpl-classic">Classic (ATS)</option>
                <option value="tpl-modern">Modern (Cards)</option>
                <option value="tpl-sidebar">Sidebar (Left)</option>
                <option value="tpl-minimal">Minimal</option>
                <option value="tpl-executive">Executive</option>
                <option value="tpl-creative">Creative</option>
              </select>
            </div>
            <div class="row">
              <label>Layout</label>
              <select id="inCompact">
                <option value="off">Normal</option>
                <option value="on">Compact</option>
              </select>
            </div>
          </div>

          <div class="row">
            <label>Color Theme</label>
            <select id="inTheme">
              <option value="">Default</option>
              <option value="theme-blue">Blue</option>
              <option value="theme-purple">Purple</option>
              <option value="theme-green">Green</option>
              <option value="theme-red">Red</option>
              <option value="theme-orange">Orange</option>
            </select>
          </div>

          <div class="grid2">
            <div class="row">
              <label>Photo</label>
              <select id="inPhotoMode">
                <option value="with">With Photo</option>
                <option value="without">Without Photo</option>
              </select>
            </div>
            <div class="row">
              <label>Upload Photo</label>
              <input id="inPhoto" type="file" accept="image/*" />
            </div>
          </div>
        </div>
      </div>

      <!-- Personal Info Section -->
      <div class="collapsible-section" id="sectionPersonal">
        <div class="collapsible-header" onclick="toggleSection('sectionPersonal')">
          <h3>Personal Info</h3>
          <span class="collapsible-icon">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div class="grid2">
            <div class="row">
              <label>Full Name</label>
              <input id="inName" value="Camilo Eguiazabal" />
            </div>
            <div class="row">
              <label>Title</label>
              <input id="inDegree" value="Lic. en Recursos Humanos" />
            </div>
          </div>

          <div class="row">
            <label>Headline</label>
            <input id="inHeadline" value="HRBP ¬∑ People Analytics ¬∑ Employee Experience" />
          </div>

          <div class="grid2">
            <div class="row">
              <label>Email</label>
              <input id="inEmail" value="ceguiazabal@gmail.com" />
            </div>
            <div class="row">
              <label>Phone</label>
              <input id="inPhone" value="+54 11 2396-2046" />
            </div>
          </div>

          <div class="row">
            <label>LinkedIn URL</label>
            <input id="inLinkedIn" value="https://www.linkedin.com/in/cegui" />
          </div>

          <div class="row">
            <label>Location</label>
            <input id="inLocation" value="Buenos Aires, Argentina" />
          </div>

          <div class="row">
            <label id="tProfileLbl">Profile</label>
            <textarea id="inProfile">Licenciado en Recursos Humanos con experiencia en entornos corporativos y trayectoria s√≥lida en gesti√≥n administrativa y coordinaci√≥n. Actualmente HRBP Contractor en Oracle, con foco en employee experience, comunicaci√≥n interna, ejecuci√≥n de iniciativas de RR.HH. y trabajo cross-functional.</textarea>
          </div>
        </div>
      </div>

      <!-- Additional Sections -->
      <div class="collapsible-section" id="sectionAdditional">
        <div class="collapsible-header" onclick="toggleSection('sectionAdditional')">
          <h3>Additional Info</h3>
          <span class="collapsible-icon">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div class="row">
            <label id="tAreasLbl">HR Areas (one per line)</label>
            <textarea id="inAreas">HRBP Support
Employee Experience
HR Operations
Onboarding
Internal Communications
Stakeholder Management
HR Reporting</textarea>
          </div>

          <div class="row">
            <label id="tEduLbl">Education (Title ‚Äî Institution | Detail)</label>
            <textarea id="inEdu">Lic. en Recursos Humanos ‚Äî UADE | Finalizado
Lic. en Psicolog√≠a ‚Äî UADE | En curso</textarea>
          </div>

          <div class="row">
            <label id="tCoursesLbl">Additional Training (Course | Institution)</label>
            <textarea id="inCourses">Planificaci√≥n y gesti√≥n de RR.HH. para PyMEs | CAME / UTN
T√©cnicas de selecci√≥n de RR.HH. | CAME / UTN
Conducci√≥n de equipos | CAME / UTN
Comunicaci√≥n y organizaciones | CAME / UTN</textarea>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="btns">
        <button id="btnPDF" type="button">üìÑ Generate PDF</button>
        <button id="btnTranslateEN" class="secondary" type="button">üåê Translate to EN</button>
        <button id="btnReset" class="secondary" type="button">üîÑ Reset</button>
      </div>

      <div class="miniActions">
        <button id="btnSave" class="secondary" type="button">üíæ Save</button>
        <button id="btnLoad" class="secondary" type="button">üìÇ Load</button>
        <button id="btnExport" class="secondary" type="button">üì§ Export</button>
        <button id="btnImport" class="secondary" type="button">üì• Import</button>
      </div>

      <!-- EDITOR EXPERIENCIA -->
      <div class="jobsEditor">
        <div class="jobsHeader">
          <h3 id="tExpEdit">Experience (edit)</h3>
          <button id="btnAddJob" class="secondary" type="button">+ Add Job</button>
        </div>
        <div id="jobsEditorList"></div>
      </div>

      <div class="hint">
        üí° Auto-pagination: Content flows to page 2 when needed. Drag jobs to reorder.
      </div>
    </aside>

    <!-- PREVIEW -->
    <section class="stage">
      <div class="paperStack" id="paperStack">

        <!-- PAGE 1 -->
        <div class="paper" data-page="1">
          <div class="page" id="cvPage1">

            <div class="header">
              <div>
                <h1 class="name" id="cvName">Camilo Eguiazabal</h1>
                <div class="headline" id="cvHeadline">HRBP ¬∑ People Analytics ¬∑ Employee Experience</div>
                <div class="degree" id="cvDegree">Lic. en Recursos Humanos</div>

                <div class="contact" id="cvContact">
                  <span id="cvLocation">Buenos Aires, Argentina</span> ¬∑
                  <a id="cvEmail" href="mailto:ceguiazabal@gmail.com">ceguiazabal@gmail.com</a> ¬∑
                  <a id="cvPhone" href="tel:+541123962046">+54 11 2396-2046</a> ¬∑
                  <a id="cvLinkedIn" href="https://www.linkedin.com/in/cegui" target="_blank">linkedin.com/in/cegui</a>
                </div>
              </div>

              <div class="photo" id="cvPhotoBox">
                <span id="cvPhotoLabel">PHOTO</span>
                <img id="cvPhotoImg" alt="Photo" style="display:none"/>
              </div>
            </div>

            <div class="layout" id="cvLayout">
              <!-- MAIN -->
              <div id="cvMain">
                <div class="section card">
                  <h2 class="title" id="tProfile">Profile</h2>
                  <p class="p" id="cvProfile"></p>
                </div>

                <div class="section card">
                  <h2 class="title" id="tExperience">Experience</h2>
                  <div id="cvJobsPage1"></div>
                </div>
              </div>

              <!-- SIDE -->
              <aside id="cvSide">
                <div class="card" id="cardAreas">
                  <h2 class="title" id="tAreas">HR Areas</h2>
                  <ul class="list" id="cvAreas"></ul>
                </div>

                <div class="card" id="cardEdu">
                  <h2 class="title" id="tEdu">Education</h2>
                  <div id="cvEdu"></div>
                </div>

                <div class="card" id="cardCourses" style="margin-bottom:0;">
                  <h2 class="title" id="tCourses">Additional Training</h2>
                  <div class="rows" id="cvCourses"></div>
                </div>
              </aside>
            </div>

          </div>
        </div>

        <!-- PAGE 2 -->
        <div class="paper" data-page="2" id="paper2" style="display:none;">
          <div class="page" id="cvPage2">
            <div class="section card" style="margin-bottom:0;">
              <h2 class="title" id="tExperience2">Experience</h2>
              <div id="cvJobsPage2"></div>
              <div id="cvPage2Extras"></div>
            </div>
          </div>
        </div>

      </div>
    </section>

  </div>

  <script>
    // -----------------------------
    // HELPERS
    // -----------------------------
    const STORAGE_KEY = "cv_builder_draft_v3";

    const DEFAULT_JOBS = [
      {
        role: "HRBP Contractor ‚Äî Oracle",
        meta: "Buenos Aires, Argentina",
        dates: "2023 ‚Äì Present",
        bullets: [
          "Partner with leaders and teams on employee lifecycle matters, driving engagement across 50+ employees",
          "Coordinate cross-functionally with HR, Facilities, and Finance to execute strategic initiatives",
          "Manage employee experience programs, benefits administration, and engagement activities",
          "Build and maintain HR reports and operational documentation"
        ]
      },
      {
        role: "HR Analyst ‚Äî Grupo Suessa",
        meta: "CABA, Argentina",
        dates: "Dec 2022 ‚Äì 2023",
        bullets: [
          "Organized end-to-end recruitment processes, onboarding, and administrative follow-up",
          "Coordinated with candidates and provided operational support to HR team"
        ]
      },
      {
        role: "Academic & Administrative Management ‚Äî CFP N¬∫26",
        meta: "CABA, Argentina",
        dates: "2015 ‚Äì 2022",
        bullets: [
          "Progressive career: Administrative Assistant / Preceptor ‚Üí Pedagogical Team ‚Üí Head of Student Department",
          "Managed documentation, student services, and institutional coordination"
        ]
      }
    ];

    let jobs = JSON.parse(JSON.stringify(DEFAULT_JOBS));
    const $ = (id) => document.getElementById(id);

    function escapeHTML(str){
      return (str ?? "").replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
      }[m]));
    }
    function toTelHref(phone){
      const clean = (phone || "").trim().replace(/[^\d+]/g,"");
      return clean.startsWith("+") ? clean : ("+" + clean);
    }
    function linkedinLabel(url){
      try{
        const u = new URL(url);
        return (u.hostname.replace(/^www\./,"") + u.pathname).replace(/\/$/,"");
      }catch{
        return (url || "").replace(/^https?:\/\//,"").replace(/\/$/,"");
      }
    }

    function showLoading(text = "Processing..."){
      $("loadingText").textContent = text;
      $("loadingOverlay").classList.add("active");
    }

    function hideLoading(){
      $("loadingOverlay").classList.remove("active");
    }

    // -----------------------------
    // Mobile Collapsible Sections
    // -----------------------------
    function toggleSection(sectionId){
      if(window.innerWidth > 768) return;
      const section = $(sectionId);
      section.classList.toggle("collapsed");
    }

    // -----------------------------
    // Photo mode
    // -----------------------------
    function setPhotoMode(mode){
      const withPhoto = (mode === "with");
      $("inPhoto").disabled = !withPhoto;
      document.body.classList.toggle("no-photo", !withPhoto);

      if(!withPhoto){
        $("inPhoto").value = "";
        $("cvPhotoImg").style.display = "none";
        $("cvPhotoLabel").style.display = "block";
      }
    }

    // -----------------------------
    // Translation (ES -> EN)
    // -----------------------------
    const GLOSSARY = [
      [/\bRecursos Humanos\b/gi, "Human Resources"],
      [/\bRR\.?HH\.?\b/gi, "HR"],
      [/\bActualidad\b/gi, "Present"],
      [/\bExperiencia\b/gi, "Experience"],
      [/\bPerfil\b/gi, "Profile"],
      [/\bEducaci√≥n\b/gi, "Education"],
      [/\bFormaci√≥n complementaria\b/gi, "Additional Training"],
      [/\b√Åreas HR\b/gi, "HR Areas"],
      [/\bComunicaci[o√≥]n interna\b/gi, "Internal Communications"],
      [/\bBeneficios\b/gi, "Benefits"],
      [/\bGesti√≥n\b/gi, "Management"],
      [/\bCoordinaci[o√≥]n\b/gi, "Coordination"],
      [/\bSoporte\b/gi, "Support"],
      [/\bcolaborador(es)?\b/gi, "employees"],
      [/\bCiclo de vida\b/gi, "lifecycle"],
      [/\bReportes\b/gi, "reports"],
      [/\bDocumentaci√≥n\b/gi, "documentation"],
      [/\bDic\b/gi, "Dec"]
    ];

    function tHeuristic(text){
      let out = text || "";
      for(const [re, rep] of GLOSSARY) out = out.replace(re, rep);
      return out;
    }

    function translateStructuredToEN(){
      document.documentElement.lang = "en";

      $("tProfileLbl").textContent = "Profile";
      $("tAreasLbl").textContent = "HR Areas (one per line)";
      $("tEduLbl").textContent = "Education (Degree ‚Äî Institution | Detail)";
      $("tCoursesLbl").textContent = "Additional Training (Course | Institution)";
      $("tExpEdit").textContent = "Experience (edit)";

      $("tProfile").textContent = "Profile";
      $("tExperience").textContent = "Experience";
      $("tExperience2").textContent = "Experience";
      $("tAreas").textContent = "HR Areas";
      $("tEdu").textContent = "Education";
      $("tCourses").textContent = "Additional Training";

      $("inDegree").value = tHeuristic($("inDegree").value);
      $("inProfile").value = tHeuristic($("inProfile").value);

      $("inAreas").value = $("inAreas").value.split("\n").map(s=>tHeuristic(s.trim())).filter(Boolean).join("\n");

      $("inEdu").value = $("inEdu").value.split("\n").map(s=>{
        const line = s.trim(); if(!line) return "";
        const parts = line.split("|").map(x=>x.trim());
        const left = tHeuristic(parts[0]||"");
        const right = tHeuristic(parts[1]||"");
        return parts.length === 2 ? `${left} | ${right}` : left;
      }).filter(Boolean).join("\n");

      $("inCourses").value = $("inCourses").value.split("\n").map(s=>{
        const line = s.trim(); if(!line) return "";
        const parts = line.split("|").map(x=>x.trim());
        const left = tHeuristic(parts[0]||"");
        const right = tHeuristic(parts[1]||"");
        return parts.length === 2 ? `${left} | ${right}` : left;
      }).filter(Boolean).join("\n");

      jobs = jobs.map(j=>({
        role: tHeuristic(j.role),
        meta: tHeuristic(j.meta),
        dates: tHeuristic(j.dates),
        bullets: (j.bullets||[]).map(b=>tHeuristic(b))
      }));
    }

    function detectLang(){
      const isEN = (document.documentElement.lang === "en")
        || /Human Resources/i.test($("inDegree").value || "")
        || ($("tProfileLbl").textContent || "").toLowerCase().includes("profile");
      return isEN ? "en" : "es";
    }

    // -----------------------------
    // AI Features (Claude API)
    // -----------------------------
    async function callClaudeAPI(messages, systemPrompt = ""){
      try{
        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 2000,
            system: systemPrompt,
            messages: messages
          })
        });

        if(!response.ok){
          throw new Error(`API error: ${response.status}`);
        }

        const data = await response.json();
        return data.content
          .filter(item => item.type === "text")
          .map(item => item.text)
          .join("\n");
      }catch(error){
        console.error("Claude API error:", error);
        throw error;
      }
    }

    async function aiOptimizeBullets(){
      showLoading("‚ú® AI is optimizing your bullets...");
      
      try{
        const allBullets = jobs.flatMap(j => j.bullets || []);
        const prompt = `Optimize these resume bullets for ATS and impact. Make them achievement-focused with metrics where possible. Keep the same number of bullets. Return ONLY the optimized bullets, one per line:

${allBullets.join("\n")}`;

        const result = await callClaudeAPI([
          { role: "user", content: prompt }
        ], "You are an expert resume writer. Optimize resume bullets to be achievement-focused, use strong action verbs, and include metrics when possible.");

        const optimizedBullets = result.split("\n").filter(b => b.trim());
        
        let idx = 0;
        jobs = jobs.map(j => {
          const count = (j.bullets || []).length;
          const newBullets = optimizedBullets.slice(idx, idx + count);
          idx += count;
          return { ...j, bullets: newBullets };
        });

        renderJobsEditor();
        syncText();
        autoSaveSoft();
        hideLoading();
        alert("‚ú® Bullets optimized! Review and adjust as needed.");
      }catch(error){
        hideLoading();
        alert("‚ùå AI optimization failed. Please try again.");
      }
    }

    async function aiEnhanceProfile(){
      showLoading("‚ú® AI is enhancing your profile...");
      
      try{
        const currentProfile = $("inProfile").value;
        const jobTitles = jobs.map(j => j.role).join(", ");
        
        const prompt = `Enhance this professional profile to be more compelling and ATS-friendly. Keep it concise (2-3 sentences). Current profile:

${currentProfile}

Job history: ${jobTitles}

Return ONLY the enhanced profile text.`;

        const result = await callClaudeAPI([
          { role: "user", content: prompt }
        ], "You are an expert resume writer. Create compelling, ATS-optimized professional summaries.");

        $("inProfile").value = result.trim();
        syncText();
        autoSaveSoft();
        hideLoading();
        alert("‚ú® Profile enhanced!");
      }catch(error){
        hideLoading();
        alert("‚ùå AI enhancement failed. Please try again.");
      }
    }

    async function aiGenerateJobDescription(){
      const jobTitle = prompt("Enter job title (e.g., 'Senior HRBP', 'HR Manager'):");
      if(!jobTitle) return;

      showLoading("‚ú® AI is generating job description...");
      
      try{
        const prompt = `Generate 3-4 strong, achievement-focused resume bullets for a ${jobTitle} position. Include metrics and impact. Return ONLY the bullets, one per line.`;

        const result = await callClaudeAPI([
          { role: "user", content: prompt }
        ], "You are an expert resume writer. Generate compelling, metrics-driven resume bullets.");

        const bullets = result.split("\n").filter(b => b.trim());
        
        jobs.unshift({
          role: jobTitle,
          meta: "Location",
          dates: "Year ‚Äì Year",
          bullets: bullets
        });

        renderJobsEditor();
        syncText();
        autoSaveSoft();
        hideLoading();
        alert("‚ú® Job description generated! Edit the details.");
      }catch(error){
        hideLoading();
        alert("‚ùå AI generation failed. Please try again.");
      }
    }

    $("btnAIOptimize").addEventListener("click", aiOptimizeBullets);
    $("btnAIProfile").addEventListener("click", aiEnhanceProfile);
    $("btnAIGenerate").addEventListener("click", aiGenerateJobDescription);

    // -----------------------------
    // Render CV
    // -----------------------------
    function renderAreas(){
      const lines = $("inAreas").value.split("\n").map(s=>s.trim()).filter(Boolean);
      $("cvAreas").innerHTML = lines.map(l => `<li>${escapeHTML(l)}</li>`).join("");
    }

    function renderEdu(){
      const lines = $("inEdu").value.split("\n").map(s=>s.trim()).filter(Boolean);
      $("cvEdu").innerHTML = lines.map(l => {
        const parts = l.split("|").map(s=>s.trim());
        if(parts.length === 2){
          return `<p style="margin:0 0 3mm 0;"><strong>${escapeHTML(parts[0])}</strong><br><span style="color:var(--muted)">${escapeHTML(parts[1])}</span></p>`;
        }
        return `<p style="margin:0 0 3mm 0;"><strong>${escapeHTML(l)}</strong></p>`;
      }).join("");
    }

    function renderCourses(){
      const lines = $("inCourses").value.split("\n").map(s=>s.trim()).filter(Boolean);
      $("cvCourses").innerHTML = lines.map(l => {
        const parts = l.split("|").map(s=>s.trim());
        const left = parts[0] ?? "";
        const right = parts[1] ?? "";
        return `
          <div class="row2">
            <div class="l">${escapeHTML(left)}</div>
            <div class="r">${escapeHTML(right)}</div>
          </div>
        `;
      }).join("");
    }

    function jobNode(j){
      const wrap = document.createElement("div");
      wrap.className = "job";
      wrap.innerHTML = `
        <div class="jobhead">
          <p class="jobrole">${escapeHTML(j.role)}</p>
          <div class="jobdate">${escapeHTML(j.dates)}</div>
        </div>
        <div class="jobmeta">${escapeHTML(j.meta)}</div>
        <ul class="bullets">
          ${(j.bullets||[]).map(b => `<li>${escapeHTML(b)}</li>`).join("")}
        </ul>
      `;
      return wrap;
    }

    function getHighlights(max=4){
      const out = [];
      for(const j of jobs.slice(0,2)){
        for(const b of (j.bullets||[])){
          const s = (b||"").trim();
          if(!s) continue;
          out.push(s);
          if(out.length >= max) return out;
        }
      }
      return out;
    }

    function renderPage2ExtrasIfNeeded(){
      const extras = $("cvPage2Extras");
      extras.innerHTML = "";

      const paper2 = $("paper2");
      if(paper2.style.display === "none") return;

      const p2Jobs = $("cvJobsPage2");
      const jobsCount = p2Jobs.children.length;

      const page2 = $("cvPage2");
      const usedRatio = page2.scrollHeight / page2.clientHeight;

      if(jobsCount >= 2 && usedRatio > 0.75) return;

      const highlights = getHighlights(4);
      const areasLines = $("inAreas").value.split("\n").map(s=>s.trim()).filter(Boolean);

      const wrapper = document.createElement("div");
      wrapper.className = "page2Grid";

      const tAreas = $("tAreas").textContent || "HR Areas";
      const tEdu = $("tEdu").textContent || "Education";
      const tCourses = $("tCourses").textContent || "Additional Training";

      wrapper.innerHTML = `
        <div class="card span2">
          <h2 class="title">Highlights</h2>
          <ul class="bullets">
            ${highlights.map(h=>`<li>${escapeHTML(h)}</li>`).join("")}
          </ul>
        </div>

        <div class="card">
          <h2 class="title">${escapeHTML(tAreas)}</h2>
          <ul class="list">
            ${areasLines.slice(0,10).map(l=>`<li>${escapeHTML(l)}</li>`).join("")}
          </ul>
        </div>

        <div class="card">
          <h2 class="title">${escapeHTML(tEdu)}</h2>
          <div>${$("cvEdu").innerHTML}</div>
        </div>

        <div class="card span2">
          <h2 class="title">${escapeHTML(tCourses)}</h2>
          <div class="rows">${$("cvCourses").innerHTML}</div>
        </div>
      `;

      extras.appendChild(wrapper);
    }

    function renderJobsAutoPaginate(){
      const p1 = $("cvJobsPage1");
      const p2 = $("cvJobsPage2");
      p1.innerHTML = "";
      p2.innerHTML = "";
      $("cvPage2Extras").innerHTML = "";
      $("paper2").style.display = "none";

      jobs.forEach(j => p1.appendChild(jobNode(j)));

      const page1 = $("cvPage1");
      const overflow1 = () => (page1.scrollHeight - page1.clientHeight);

      if(overflow1() <= 2) return;

      $("paper2").style.display = "block";

      for(let guard=0; guard<260; guard++){
        if(overflow1() <= 2) break;
        const last = p1.lastElementChild;
        if(!last) break;
        p2.insertBefore(last, p2.firstChild);
      }

      renderPage2ExtrasIfNeeded();
    }

    function syncText(){
      $("cvName").textContent = $("inName").value || "";
      $("cvHeadline").textContent = $("inHeadline").value || "";
      $("cvDegree").textContent = $("inDegree").value || "";
      $("cvProfile").textContent = $("inProfile").value || "";

      const location = $("inLocation").value || "";
      const email = $("inEmail").value || "";
      const phone = $("inPhone").value || "";
      const linkedin = $("inLinkedIn").value || "";

      $("cvLocation").textContent = location;

      $("cvEmail").textContent = email;
      $("cvEmail").href = email ? `mailto:${email}` : "#";

      $("cvPhone").textContent = phone;
      $("cvPhone").href = phone ? `tel:${toTelHref(phone)}` : "#";

      $("cvLinkedIn").textContent = linkedinLabel(linkedin);
      $("cvLinkedIn").href = linkedin || "#";

      renderAreas();
      renderEdu();
      renderCourses();
      renderJobsAutoPaginate();
    }

    // -----------------------------
    // Jobs editor with Drag & Drop
    // -----------------------------
    let draggedIndex = null;

    function renderJobsEditor(){
      const list = $("jobsEditorList");
      list.innerHTML = "";
      jobs.forEach((j, idx) => {
        const card = document.createElement("div");
        card.className = "jobCard";
        card.draggable = true;
        card.dataset.idx = idx;
        
        card.innerHTML = `
          <div class="jobCardTop">
            <div style="font-weight:900; font-size:13px;">üíº Job #${idx+1}</div>
            <div class="mini">
              <button class="secondary" data-act="up" data-idx="${idx}">‚Üë</button>
              <button class="secondary" data-act="down" data-idx="${idx}">‚Üì</button>
              <button class="danger" data-act="del" data-idx="${idx}">Delete</button>
            </div>
          </div>

          <div class="grid2" style="margin-bottom:8px;">
            <div class="row" style="margin:0;">
              <label>Role ‚Äî Company</label>
              <input data-k="role" data-idx="${idx}" value="${escapeHTML(j.role)}"/>
            </div>
            <div class="row" style="margin:0;">
              <label>Dates</label>
              <input data-k="dates" data-idx="${idx}" value="${escapeHTML(j.dates)}"/>
            </div>
          </div>

          <div class="row" style="margin-bottom:8px;">
            <label>Location</label>
            <input data-k="meta" data-idx="${idx}" value="${escapeHTML(j.meta)}"/>
          </div>

          <div class="row" style="margin:0;">
            <label>Bullets (one per line)</label>
            <textarea data-k="bullets" data-idx="${idx}">${escapeHTML((j.bullets||[]).join("\n"))}</textarea>
          </div>
        `;

        // Drag events
        card.addEventListener("dragstart", (e) => {
          draggedIndex = idx;
          card.classList.add("dragging");
        });

        card.addEventListener("dragend", (e) => {
          card.classList.remove("dragging");
          draggedIndex = null;
        });

        card.addEventListener("dragover", (e) => {
          e.preventDefault();
        });

        card.addEventListener("drop", (e) => {
          e.preventDefault();
          if(draggedIndex === null || draggedIndex === idx) return;
          
          const item = jobs.splice(draggedIndex, 1)[0];
          jobs.splice(idx, 0, item);
          
          renderJobsEditor();
          syncText();
          autoSaveSoft();
        });

        list.appendChild(card);
      });
    }

    function moveJob(idx, dir){
      const newIdx = idx + dir;
      if(newIdx < 0 || newIdx >= jobs.length) return;
      [jobs[idx], jobs[newIdx]] = [jobs[newIdx], jobs[idx]];
      renderJobsEditor();
      syncText();
    }

    function deleteJob(idx){
      if(!confirm("Delete this job?")) return;
      jobs.splice(idx, 1);
      renderJobsEditor();
      syncText();
    }

    function addJob(){
      jobs.unshift({
        role: "New Role ‚Äî Company",
        meta: "Location",
        dates: "Year ‚Äì Year",
        bullets: ["Achievement 1", "Achievement 2"]
      });
      renderJobsEditor();
      syncText();
    }

    $("jobsEditorList").addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if(!btn) return;
      const act = btn.dataset.act;
      const idx = Number(btn.dataset.idx);
      if(Number.isNaN(idx)) return;
      if(act === "up") moveJob(idx, -1);
      if(act === "down") moveJob(idx, 1);
      if(act === "del") deleteJob(idx);
      autoSaveSoft();
    });

    $("jobsEditorList").addEventListener("input", (e) => {
      const el = e.target;
      const idx = Number(el.dataset.idx);
      const k = el.dataset.k;
      if(Number.isNaN(idx) || !k) return;

      if(k === "bullets"){
        jobs[idx].bullets = el.value.split("\n").map(s=>s.trim()).filter(Boolean);
        if(jobs[idx].bullets.length === 0) jobs[idx].bullets = [""];
      } else {
        jobs[idx][k] = el.value;
      }
      syncText();
      autoSaveSoft();
    });

    $("btnAddJob").addEventListener("click", () => { addJob(); autoSaveSoft(); });

    // -----------------------------
    // Photo upload
    // -----------------------------
    $("inPhoto").addEventListener("change", (e) => {
      if($("inPhotoMode").value !== "with") return;
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        $("cvPhotoImg").src = reader.result;
        $("cvPhotoImg").style.display = "block";
        $("cvPhotoLabel").style.display = "none";
        autoSaveSoft();
      };
      reader.readAsDataURL(file);
    });

    // -----------------------------
    // Template, Compact, Theme, Photo mode
    // -----------------------------
    $("inTemplate").addEventListener("change", () => {
      document.body.classList.remove("tpl-classic","tpl-modern","tpl-sidebar","tpl-minimal","tpl-executive","tpl-creative");
      document.body.classList.add($("inTemplate").value);
      syncText();
      autoSaveSoft();
    });

    $("inCompact").addEventListener("change", () => {
      document.body.classList.toggle("compact", $("inCompact").value === "on");
      syncText();
      autoSaveSoft();
    });

    $("inTheme").addEventListener("change", () => {
      document.body.classList.remove("theme-blue","theme-purple","theme-green","theme-red","theme-orange");
      if($("inTheme").value) document.body.classList.add($("inTheme").value);
      syncText();
      autoSaveSoft();
    });

    $("inPhotoMode").addEventListener("change", () => {
      setPhotoMode($("inPhotoMode").value);
      syncText();
      autoSaveSoft();
    });

    // -----------------------------
    // Live updates
    // -----------------------------
    const LIVE_IDS = [
      "inName","inHeadline","inDegree",
      "inEmail","inPhone","inLinkedIn","inLocation",
      "inProfile","inAreas","inEdu","inCourses"
    ];
    LIVE_IDS.forEach(id => $(id).addEventListener("input", () => { syncText(); autoSaveSoft(); }));

    // -----------------------------
    // Save / Load / Export / Import
    // -----------------------------
    function getDraft(){
      const photoEnabled = ($("inPhotoMode").value === "with");
      return {
        meta: {
          template: $("inTemplate").value,
          compact: $("inCompact").value,
          theme: $("inTheme").value,
          photoMode: $("inPhotoMode").value,
          photoDataUrl: (photoEnabled && $("cvPhotoImg").style.display !== "none") ? $("cvPhotoImg").src : ""
        },
        fields: {
          inName: $("inName").value,
          inDegree: $("inDegree").value,
          inHeadline: $("inHeadline").value,
          inEmail: $("inEmail").value,
          inPhone: $("inPhone").value,
          inLinkedIn: $("inLinkedIn").value,
          inLocation: $("inLocation").value,
          inProfile: $("inProfile").value,
          inAreas: $("inAreas").value,
          inEdu: $("inEdu").value,
          inCourses: $("inCourses").value
        },
        jobs
      };
    }

    function applyDraft(d){
      if(!d || typeof d !== "object") return;

      if(d.meta?.template){
        $("inTemplate").value = d.meta.template;
        document.body.classList.remove("tpl-classic","tpl-modern","tpl-sidebar","tpl-minimal","tpl-executive","tpl-creative");
        document.body.classList.add(d.meta.template);
      }
      if(d.meta?.compact){
        $("inCompact").value = d.meta.compact;
        document.body.classList.toggle("compact", d.meta.compact === "on");
      }
      if(d.meta?.theme !== undefined){
        $("inTheme").value = d.meta.theme || "";
        document.body.classList.remove("theme-blue","theme-purple","theme-green","theme-red","theme-orange");
        if(d.meta.theme) document.body.classList.add(d.meta.theme);
      }
      if(d.meta?.photoMode){
        $("inPhotoMode").value = d.meta.photoMode;
        setPhotoMode(d.meta.photoMode);
      }

      const f = d.fields || {};
      for(const k of Object.keys(f)){
        if($(k)) $(k).value = f[k] ?? "";
      }

      if(Array.isArray(d.jobs)) jobs = d.jobs;

      if(d.meta?.photoMode === "with" && d.meta?.photoDataUrl){
        $("cvPhotoImg").src = d.meta.photoDataUrl;
        $("cvPhotoImg").style.display = "block";
        $("cvPhotoLabel").style.display = "none";
      }

      renderJobsEditor();
      syncText();
    }

    function saveDraftHard(){
      const draft = getDraft();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(draft));
    }

    function loadDraftHard(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      try{
        const d = JSON.parse(raw);
        applyDraft(d);
        return true;
      }catch{
        return false;
      }
    }

    let saveTimer = null;
    function autoSaveSoft(){
      clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        try{ saveDraftHard(); }catch{}
      }, 500);
    }

    async function tryCopy(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch{
        return false;
      }
    }

    $("btnSave").addEventListener("click", () => {
      saveDraftHard();
      alert("‚úÖ Draft saved!");
    });

    $("btnLoad").addEventListener("click", () => {
      const ok = loadDraftHard();
      if(ok) alert("‚úÖ Draft loaded!");
      else alert("‚ùå No saved draft found.");
    });

    $("btnExport").addEventListener("click", async () => {
      const json = JSON.stringify(getDraft(), null, 2);
      const copied = await tryCopy(json);
      if(copied) alert("‚úÖ JSON copied to clipboard!");
      else prompt("Copy this JSON:", json);
    });

    $("btnImport").addEventListener("click", () => {
      const raw = prompt("Paste exported JSON:");
      if(!raw) return;
      try{
        const d = JSON.parse(raw);
        applyDraft(d);
        alert("‚úÖ Imported successfully!");
      }catch{
        alert("‚ùå Invalid JSON.");
      }
    });

    // -----------------------------
    // PDF export
    // -----------------------------
    function getVisiblePapers(){
      return Array.from(document.querySelectorAll(".paper"))
        .filter(p => p.style.display !== "none");
    }

    function pxToMm(px, elementPxWidth){
      return (px * 210) / elementPxWidth;
    }

    function getRectMmWithinPage(el, pageEl){
      const r = el.getBoundingClientRect();
      const pr = pageEl.getBoundingClientRect();
      const pageWidthPx = pr.width;
      const xPx = r.left - pr.left;
      const yPx = r.top - pr.top;
      return {
        x: pxToMm(xPx, pageWidthPx),
        y: pxToMm(yPx, pageWidthPx),
        w: pxToMm(r.width, pageWidthPx),
        h: pxToMm(r.height, pageWidthPx)
      };
    }

    async function exportPdfRobusto(){
      const html2canvasFn = window.html2canvas;
      const jsPDFmod = window.jspdf;
      if(!html2canvasFn || !jsPDFmod?.jsPDF){
        throw new Error("html2canvas or jsPDF not available");
      }

      const { jsPDF } = jsPDFmod;
      const pdf = new jsPDF({ unit: "mm", format: "a4", orientation: "portrait" });
      const pages = getVisiblePapers();
      const filename = `CV_${($("inName").value || "CV").replace(/\s+/g,"_")}.pdf`;

      for(let i=0; i<pages.length; i++){
        const paper = pages[i];

        const canvas = await html2canvasFn(paper, {
          scale: 2,
          useCORS: true,
          backgroundColor: "#ffffff",
          scrollX: 0,
          scrollY: 0
        });

        const imgData = canvas.toDataURL("image/jpeg", 0.98);
        if(i > 0) pdf.addPage("a4", "portrait");
        pdf.addImage(imgData, "JPEG", 0, 0, 210, 297);

        const pageEl = paper.querySelector(".page");
        if(pageEl){
          const emailEl = $("cvEmail");
          const phoneEl = $("cvPhone");
          const liEl = $("cvLinkedIn");

          const inThisPage = (el) => pageEl.contains(el);
          const addLink = (el, url) => {
            const rr = getRectMmWithinPage(el, pageEl);
            const pad = 0.6;
            pdf.link(rr.x - pad, rr.y - pad, rr.w + pad*2, rr.h + pad*2, { url });
          };

          if(inThisPage(emailEl) && emailEl.href && emailEl.href !== "#") addLink(emailEl, emailEl.href);
          if(inThisPage(phoneEl) && phoneEl.href && phoneEl.href !== "#") addLink(phoneEl, phoneEl.href);
          if(inThisPage(liEl) && liEl.href && liEl.href !== "#") addLink(liEl, liEl.href);
        }
      }

      pdf.save(filename);
    }

    async function exportPdfFallbackHtml2Pdf(){
      const filename = `CV_${($("inName").value || "CV").replace(/\s+/g,"_")}.pdf`;
      const stack = $("paperStack");
      const opt = {
        margin: 0,
        filename,
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: {
          scale: 2,
          useCORS: true,
          backgroundColor: "#ffffff",
          scrollX: 0,
          scrollY: 0
        },
        jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
        pagebreak: { mode: ["css", "legacy"] }
      };
      await html2pdf().set(opt).from(stack).save();
    }

    $("btnPDF").addEventListener("click", async () => {
      syncText();
      showLoading("üìÑ Generating PDF...");
      
      try{
        await exportPdfRobusto();
        hideLoading();
      }catch(err){
        console.warn("Robust export failed, using fallback:", err);
        try{
          await exportPdfFallbackHtml2Pdf();
          hideLoading();
        }catch(err2){
          hideLoading();
          alert("‚ùå PDF generation failed. Please try again.");
        }
      }
    });

    // -----------------------------
    // Translate to EN
    // -----------------------------
    $("btnTranslateEN").addEventListener("click", () => {
      if(confirm("Translate all content to English?")){
        translateStructuredToEN();
        syncText();
        autoSaveSoft();
        alert("‚úÖ Translated to English!");
      }
    });

    // -----------------------------
    // Reset
    // -----------------------------
    $("btnReset").addEventListener("click", () => {
      if(!confirm("Reset to default? This will erase all changes.")) return;
      
      localStorage.removeItem(STORAGE_KEY);
      document.documentElement.lang = "es";

      $("inTemplate").value = "tpl-classic";
      document.body.classList.remove("tpl-classic","tpl-modern","tpl-sidebar","tpl-minimal","tpl-executive","tpl-creative","compact","no-photo","theme-blue","theme-purple","theme-green","theme-red","theme-orange");
      document.body.classList.add("tpl-classic");
      
      $("inCompact").value = "off";
      $("inTheme").value = "";
      $("inPhotoMode").value = "with";
      setPhotoMode("with");

      $("tProfileLbl").textContent = "Profile";
      $("tAreasLbl").textContent = "HR Areas (one per line)";
      $("tEduLbl").textContent = "Education (Degree ‚Äî Institution | Detail)";
      $("tCoursesLbl").textContent = "Additional Training (Course | Institution)";
      $("tExpEdit").textContent = "Experience (edit)";

      $("tProfile").textContent = "Profile";
      $("tExperience").textContent = "Experience";
      $("tExperience2").textContent = "Experience";
      $("tAreas").textContent = "HR Areas";
      $("tEdu").textContent = "Education";
      $("tCourses").textContent = "Additional Training";

      $("inName").value = "Camilo Eguiazabal";
      $("inDegree").value = "Lic. en Recursos Humanos";
      $("inHeadline").value = "HRBP ¬∑ People Analytics ¬∑ Employee Experience";
      $("inEmail").value = "ceguiazabal@gmail.com";
      $("inPhone").value = "+54 11 2396-2046";
      $("inLinkedIn").value = "https://www.linkedin.com/in/cegui";
      $("inLocation").value = "Buenos Aires, Argentina";

      $("inProfile").value = "Licenciado en Recursos Humanos con experiencia en entornos corporativos y trayectoria s√≥lida en gesti√≥n administrativa y coordinaci√≥n. Actualmente HRBP Contractor en Oracle, con foco en employee experience, comunicaci√≥n interna, ejecuci√≥n de iniciativas de RR.HH. y trabajo cross-functional.";

      $("inAreas").value = "HRBP Support\nEmployee Experience\nHR Operations\nOnboarding\nInternal Communications\nStakeholder Management\nHR Reporting";

      $("inEdu").value = "Lic. en Recursos Humanos ‚Äî UADE | Finalizado\nLic. en Psicolog√≠a ‚Äî UADE | En curso";

      $("inCourses").value = "Planificaci√≥n y gesti√≥n de RR.HH. para PyMEs | CAME / UTN\nT√©cnicas de selecci√≥n de RR.HH. | CAME / UTN\nConducci√≥n de equipos | CAME / UTN\nComunicaci√≥n y organizaciones | CAME / UTN";

      jobs = JSON.parse(JSON.stringify(DEFAULT_JOBS));

      $("inPhoto").value = "";
      $("cvPhotoImg").style.display = "none";
      $("cvPhotoLabel").style.display = "block";

      renderJobsEditor();
      syncText();
      alert("‚úÖ Reset complete!");
    });

    // -----------------------------
    // INIT
    // -----------------------------
    setPhotoMode($("inPhotoMode").value);
    renderJobsEditor();
    const loaded = loadDraftHard();
    if(!loaded) syncText();

    // Collapse sections on mobile by default
    if(window.innerWidth <= 768){
      ["sectionTemplate", "sectionAdditional"].forEach(id => {
        $(id).classList.add("collapsed");
      });
    }
  </script>
</body>
</html>
